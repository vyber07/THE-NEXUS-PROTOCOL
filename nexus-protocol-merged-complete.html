<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PROTOCOL | Complete Experience</title>
    <meta name="description" content="Enter the Nexus Protocol - A cyberpunk narrative experience following the complete game design lore">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <style>
        /* ===== NEXUS PROTOCOL - COMPLETE DESIGN SYSTEM ===== */
        /* Based on Game Design & Lore Document v3.0.0 */
        
        :root {
            /* Core Color Palette - Year 2074 Aesthetic */
            --nexus-teal: #0AC8B9;
            --corporate-gold: #D4AF37;
            --system-purple: #8B5CF6;
            --alert-red: #FF4655;
            --void-black: #0A0E14;
            
            /* Agent-Specific Colors */
            --hacker-primary: #FF1744;
            --hacker-secondary: #F1C76C;
            --hacker-accent: #FF3E3E;
            
            --infiltrator-primary: #00D4FF;
            --infiltrator-secondary: #FF10F0;
            --infiltrator-accent: #9D4EDD;
            
            --analyst-primary: #0AC8B9;
            --analyst-secondary: #0AC8B9;
            --analyst-accent: #00FF9F;
            
            /* Background Layers */
            --bg-dark: #0A0E14;
            --bg-panel: #141B24;
            --bg-card: #1A2332;
            --bg-border: #2A3F54;
            
            /* Text Hierarchy */
            --text-primary: #ECE8E1;
            --text-secondary: #A0AEC0;
            --text-muted: #7A8A99;
            
            /* Typography */
            --font-mono: 'JetBrains Mono', monospace;
            --font-display: 'Orbitron', sans-serif;
            
            /* Transitions */
            --transition-fast: 0.2s ease-out;
            --transition-medium: 0.4s ease-out;
            --transition-slow: 0.8s ease-out;
            
            /* Current Theme (Dynamic) */
            --theme-primary: var(--analyst-primary);
            --theme-secondary: var(--analyst-secondary);
            --theme-accent: var(--analyst-accent);
            --theme-glow: rgba(10, 200, 185, 0.3);
        }

        /* ===== RESET & BASE STYLES ===== */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: var(--font-mono);
            background: linear-gradient(135deg, var(--bg-dark), var(--bg-panel));
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ===== THEME SYSTEM ===== */
        [data-theme="hacker"] {
            --theme-primary: var(--hacker-primary);
            --theme-secondary: var(--hacker-secondary);
            --theme-accent: var(--hacker-accent);
            --theme-glow: rgba(255, 23, 68, 0.3);
        }

        [data-theme="infiltrator"] {
            --theme-primary: var(--infiltrator-primary);
            --theme-secondary: var(--infiltrator-secondary);
            --theme-accent: var(--infiltrator-accent);
            --theme-glow: rgba(0, 212, 255, 0.3);
        }

        [data-theme="analyst"] {
            --theme-primary: var(--analyst-primary);
            --theme-secondary: var(--analyst-secondary);
            --theme-accent: var(--analyst-accent);
            --theme-glow: rgba(10, 200, 185, 0.3);
        }

        /* ===== LOADING SCREEN ===== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .terminal-text {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--theme-primary);
            margin-bottom: 2rem;
            text-align: left;
            min-height: 1.5em;
        }

        .cursor {
            animation: blink 0.8s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* ===== NEXUS INTERFACE LAYOUT ===== */
        .nexus-interface {
            display: grid;
            grid-template-columns: 288px 1fr 320px;
            grid-template-rows: 60px 1fr;
            grid-template-areas: 
                "header header header"
                "left-panel center-panel right-panel";
            height: 100vh;
            background: var(--bg-dark);
        }

        .nexus-header {
            grid-area: header;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--bg-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            font-family: var(--font-display);
        }

        .nexus-left-panel {
            grid-area: left-panel;
            background: var(--bg-panel);
            border-right: 1px solid var(--bg-border);
            overflow-y: auto;
        }

        .nexus-center-panel {
            grid-area: center-panel;
            background: var(--bg-dark);
            overflow-y: auto;
            position: relative;
        }

        .nexus-right-panel {
            grid-area: right-panel;
            background: var(--bg-panel);
            border-left: 1px solid var(--bg-border);
            overflow-y: auto;
        }

        /* ===== COMPONENT LIBRARY ===== */
        .nexus-button {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: var(--font-display);
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            min-height: 44px;
            outline: none;
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-accent));
            color: #ffffff;
            padding: 12px 24px;
            border-radius: 8px;
            clip-path: polygon(0 0, calc(100% - 8px) 0, 100% 8px, 100% 100%, 8px 100%, 0 calc(100% - 8px));
        }

        .nexus-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px var(--theme-glow);
        }

        .nexus-button:focus-visible {
            outline: 2px solid var(--theme-primary);
            outline-offset: 2px;
        }

        .nexus-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .nexus-card {
            position: relative;
            background: var(--bg-card);
            border: 1px solid var(--bg-border);
            border-radius: 12px;
            padding: 24px;
            transition: all var(--transition-medium);
            overflow: hidden;
        }

        .nexus-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--theme-primary), var(--theme-accent));
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .nexus-card:hover::before {
            opacity: 1;
        }

        .nexus-card--interactive {
            cursor: pointer;
        }

        .nexus-card--interactive:hover {
            border-color: var(--theme-primary);
            box-shadow: 0 0 15px var(--theme-glow);
            transform: translateY(-2px);
        }

        .nexus-card--selected {
            border-color: var(--theme-primary);
            box-shadow: 0 0 15px var(--theme-glow);
            transform: scale(1.02);
        }

        .nexus-card--selected::before {
            opacity: 1;
        }

        /* ===== AGENT SELECTION SYSTEM ===== */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            padding: 24px;
        }

        .agent-card {
            position: relative;
            background: var(--bg-card);
            border: 2px solid var(--bg-border);
            border-radius: 16px;
            padding: 24px;
            transition: all var(--transition-medium);
            cursor: pointer;
            min-height: 400px;
        }

        .agent-card:hover {
            border-color: var(--theme-primary);
            transform: translateY(-4px);
            box-shadow: 0 8px 32px var(--theme-glow);
        }

        .agent-card.selected {
            border-color: var(--theme-primary);
            box-shadow: 0 0 24px var(--theme-glow);
            transform: scale(1.02);
        }

        .agent-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #ffffff;
        }

        .agent-stats {
            margin: 16px 0;
        }

        .stat-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .stat-name {
            width: 80px;
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .stat-progress {
            flex: 1;
            height: 4px;
            background: var(--bg-border);
            border-radius: 2px;
            margin: 0 8px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--theme-primary), var(--theme-accent));
            border-radius: 2px;
            transition: width var(--transition-medium);
        }

        .stat-value {
            width: 24px;
            font-size: 12px;
            text-align: right;
            color: var(--text-secondary);
        }

        /* ===== MISSION INTERFACE ===== */
        .mission-timeline {
            padding: 24px;
        }

        .phase-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }

        .phase-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--bg-border);
            margin-right: 12px;
            transition: all var(--transition-fast);
        }

        .phase-dot.active {
            background: var(--theme-primary);
            box-shadow: 0 0 8px var(--theme-glow);
        }

        .phase-dot.completed {
            background: var(--analyst-accent);
        }

        .objective-list {
            list-style: none;
            padding: 0;
        }

        .objective-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--bg-border);
        }

        .objective-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid var(--bg-border);
            border-radius: 3px;
            margin-right: 12px;
            transition: all var(--transition-fast);
        }

        .objective-checkbox.completed {
            background: var(--theme-primary);
            border-color: var(--theme-primary);
        }

        .objective-checkbox.completed::after {
            content: '✓';
            color: #ffffff;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        /* ===== SYSTEM LOGS ===== */
        .system-log {
            font-family: var(--font-mono);
            font-size: 12px;
            line-height: 1.4;
            padding: 16px;
            background: var(--bg-dark);
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 4px;
            opacity: 0.8;
        }

        .log-entry.error {
            color: var(--alert-red);
        }

        .log-entry.success {
            color: var(--analyst-accent);
        }

        .log-entry.warning {
            color: var(--hacker-secondary);
        }

        .log-timestamp {
            color: var(--text-muted);
            margin-right: 8px;
        }

        /* ===== TRACE SYSTEM ===== */
        .trace-meter {
            position: relative;
            height: 8px;
            background: var(--bg-border);
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .trace-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--analyst-accent), var(--hacker-secondary), var(--alert-red));
            border-radius: 4px;
            transition: width var(--transition-medium);
            position: relative;
        }

        .trace-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* ===== TRAILER SEQUENCE ===== */
        .trailer-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .trailer-text {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2rem;
            opacity: 0;
        }

        .trailer-subtitle {
            font-family: var(--font-mono);
            font-size: 1rem;
            color: var(--text-secondary);
            text-align: center;
            opacity: 0;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1024px) {
            .nexus-interface {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "center-panel";
            }
            
            .nexus-left-panel,
            .nexus-right-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .agent-grid {
                grid-template-columns: 1fr;
                padding: 16px;
            }
            
            .nexus-button {
                min-height: 48px;
            }
            
            .trailer-text {
                font-size: 1.5rem;
            }
        }

        /* ===== ACCESSIBILITY ===== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-contrast: high) {
            :root {
                --text-primary: #ffffff;
                --text-secondary: #ffffff;
                --bg-border: #ffffff;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden { display: none !important; }
        .invisible { visibility: hidden; }
        .opacity-0 { opacity: 0; }
        .opacity-50 { opacity: 0.5; }
        .opacity-100 { opacity: 1; }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        
        .font-mono { font-family: var(--font-mono); }
        .font-display { font-family: var(--font-display); }
        
        .transition-all { transition: all var(--transition-fast); }
        .transition-colors { transition: color var(--transition-fast), background-color var(--transition-fast), border-color var(--transition-fast); }
        
        .cursor-pointer { cursor: pointer; }
        .cursor-not-allowed { cursor: not-allowed; }
        
        .select-none { user-select: none; }
        
        .transform-gpu { transform: translateZ(0); }
    </style>
</head>
<body data-theme="hacker">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="terminal-text" id="terminalText">
            NEXUS PROTOCOL v7.9 / CORE SUBSYSTEM: INITIALIZING<span class="cursor">_</span>
        </div>
        <div class="w-64 h-1 bg-gray-800 rounded-full overflow-hidden">
            <div id="loadingBar" class="h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
    </div>

    <!-- Trailer Sequence -->
    <div id="trailerContainer" class="trailer-container hidden">
        <div class="trailer-text" id="trailerText">NEXUS PROTOCOL</div>
        <div class="trailer-subtitle" id="trailerSubtitle">The Protocol awaits.</div>
    </div>

    <!-- Main Interface -->
    <div id="mainInterface" class="nexus-interface hidden">
        <!-- Header -->
        <header class="nexus-header">
            <div class="flex items-center">
                <div class="font-display font-bold text-lg">NEXUS PROTOCOL</div>
                <div class="ml-4 text-sm text-gray-400">v7.9.0</div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm">
                    <span class="text-gray-400">Agent:</span>
                    <span id="currentAgent" class="font-semibold">None Selected</span>
                </div>
                <div class="text-sm">
                    <span class="text-gray-400">Status:</span>
                    <span id="systemStatus" class="font-semibold text-green-400">READY</span>
                </div>
            </div>
        </header>

        <!-- Left Panel -->
        <aside class="nexus-left-panel">
            <div class="p-6">
                <h2 class="font-display font-bold text-lg mb-4">Mission Brief</h2>
                <div class="nexus-card mb-6">
                    <h3 class="font-semibold mb-2">Operation: Chimera</h3>
                    <p class="text-sm text-gray-400 mb-2">Target: OmniCorp Core Server</p>
                    <p class="text-sm text-gray-400 mb-4">Location: Neo-Tokyo, Level 47</p>
                    <div class="trace-meter">
                        <div class="trace-fill" style="width: 0%" id="traceMeter"></div>
                    </div>
                    <p class="text-xs text-gray-500">Trace Level: <span id="traceLevel">0%</span></p>
                </div>

                <h3 class="font-semibold mb-3">Mission Phases</h3>
                <div class="space-y-3">
                    <div class="phase-indicator">
                        <div class="phase-dot active" id="phase1Dot"></div>
                        <span class="text-sm">01: BEACHHEAD</span>
                    </div>
                    <div class="phase-indicator">
                        <div class="phase-dot" id="phase2Dot"></div>
                        <span class="text-sm">02: PENETRATION</span>
                    </div>
                    <div class="phase-indicator">
                        <div class="phase-dot" id="phase3Dot"></div>
                        <span class="text-sm">03: EXTRACTION</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Center Panel -->
        <main class="nexus-center-panel">
            <!-- Agent Selection Screen -->
            <div id="agentSelection" class="p-8">
                <div class="text-center mb-8">
                    <h1 class="font-display text-3xl font-bold mb-4">SELECT YOUR AGENT</h1>
                    <p class="text-gray-400">Choose your specialization for Operation: Chimera</p>
                </div>

                <div class="agent-grid">
                    <!-- Hacker Agent -->
                    <div class="agent-card" data-agent="hacker" onclick="selectAgent('hacker')">
                        <div class="agent-icon" style="background: linear-gradient(135deg, #FF1744, #FF3E3E);">
                            H
                        </div>
                        <h3 class="font-display text-xl font-bold text-center mb-2">BREACH ARCHITECT</h3>
                        <p class="text-center text-gray-400 mb-4">System exploitation specialist</p>
                        
                        <div class="agent-stats">
                            <div class="stat-bar">
                                <span class="stat-name">Hacking</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 100%"></div>
                                </div>
                                <span class="stat-value">100</span>
                            </div>
                            <div class="stat-bar">
                                <span class="stat-name">Stealth</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 60%"></div>
                                </div>
                                <span class="stat-value">60</span>
                            </div>
                            <div class="stat-bar">
                                <span class="stat-name">Combat</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 40%"></div>
                                </div>
                                <span class="stat-value">40</span>
                            </div>
                            <div class="stat-bar">
                                <span class="stat-name">Analysis</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 70%"></div>
                                </div>
                                <span class="stat-value">70</span>
                            </div>
                        </div>

                        <div class="mt-4">
                            <div class="text-xs font-semibold mb-2">KEY ABILITIES</div>
                            <div class="text-xs text-gray-400">
                                <div class="mb-1"><strong>Cipher Cache:</strong> False telemetry echo</div>
                                <div><strong>System Lattice:</strong> Backdoor network deployment</div>
                            </div>
                        </div>
                    </div>

                    <!-- Infiltrator Agent -->
                    <div class="agent-card" data-agent="infiltrator" onclick="selectAgent('infiltrator')">
                        <div class="agent-icon" style="background: linear-gradient(135deg, #00D4FF, #9D4EDD);">
                            I
                        </div>
                        <h3 class="font-display text-xl font-bold text-center mb-2">SHADOW LINGUIST</h3>
                        <p class="text-center text-gray-400 mb-4">Social engineering specialist</p>
                        
                        <div class="agent-stats">
                            <div class="stat-bar">
                                <span class="stat-name">Hacking</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 40%"></div>
                                </div>
                                <span class="stat-value">40</span>
                            </div>
                            <div class="stat-bar">
                                <span class="stat-name">Stealth</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 100%"></div>
                                </div>
                                <span class="stat-value">100</span>
                            </div>
                            <div class="stat-bar">
                                <span class="stat-name">Combat</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 70%"></div>
                                </div>
                                <span class="stat-value">70</span>
                            </div>
                            <div class="stat-bar">
                                <span class="stat-name">Analysis</span>
                                <div class="stat-progress">
                                    <div class="stat-fill" style="width: 60%"></div>
                                </div>
                                <span class="stat-value">60</span>
                            </div>
                        </div>

                        <div class="mt-4">
                            <div class="text-xs font-semibold mb-2">KEY ABILITIES</div>
                            <div class="text-xs text-gray-400">
                                <div class="mb-1"><strong>Social Echo:</strong> Boost persuasion checks</div>
                                <div><strong>Crowd Scripting:</strong> Manipulate public telemetry</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-8">
                    <button id="confirmAgent" class="nexus-button" disabled onclick="confirmAgentSelection()">
                        CONFIRM SELECTION
                    </button>
                </div>
            </div>

            <!-- Mission Interface -->
            <div id="missionInterface" class="hidden p-8">
                <div class="text-center mb-8">
                    <h1 class="font-display text-3xl font-bold mb-4">OPERATION: CHIMERA</h1>
                    <p class="text-gray-400">Infiltrate OmniCorp Core Server - Level 47</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Current Objectives -->
                    <div class="nexus-card">
                        <h3 class="font-semibold mb-4">Current Objectives</h3>
                        <ul class="objective-list" id="objectiveList">
                            <li class="objective-item">
                                <div class="objective-checkbox" id="obj1"></div>
                                <span>Establish Secure Connection</span>
                            </li>
                            <li class="objective-item">
                                <div class="objective-checkbox" id="obj2"></div>
                                <span>Create False Identity</span>
                            </li>
                            <li class="objective-item">
                                <div class="objective-checkbox" id="obj3"></div>
                                <span>Map Security Systems</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Agent Abilities -->
                    <div class="nexus-card">
                        <h3 class="font-semibold mb-4">Agent Abilities</h3>
                        <div class="space-y-3" id="abilityPanel">
                            <!-- Abilities will be populated based on selected agent -->
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center">
                    <button class="nexus-button" onclick="startMission()">
                        BEGIN INFILTRATION
                    </button>
                </div>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="nexus-right-panel">
            <div class="p-6">
                <h3 class="font-semibold mb-4">System Logs</h3>
                <div class="system-log" id="systemLog">
                    <div class="log-entry">
                        <span class="log-timestamp">[00:00:01]</span>
                        <span>System initialized</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-timestamp">[00:00:02]</span>
                        <span>Awaiting agent selection...</span>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="font-semibold mb-4">Network Status</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Connection:</span>
                            <span class="text-green-400">SECURE</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Encryption:</span>
                            <span class="text-green-400">AES-256</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Latency:</span>
                            <span class="text-yellow-400">12ms</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // ===== NEXUS PROTOCOL - COMPLETE JAVASCRIPT IMPLEMENTATION =====
        // Based on Game Design & Lore Document v3.0.0
        
        class NexusProtocol {
            constructor() {
                this.currentAgent = null;
                this.currentPhase = 1;
                this.traceLevel = 0;
                this.objectives = [];
                this.systemLog = [];
                this.isTrailerShown = sessionStorage.getItem('nexus_trailer_shown') === 'true';
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.startLoadingSequence();
            }

            setupEventListeners() {
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                        this.resetTrailer();
                    }
                });

                // Accessibility
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        document.body.classList.add('keyboard-navigation');
                    }
                });

                document.addEventListener('mousedown', () => {
                    document.body.classList.remove('keyboard-navigation');
                });
            }

            startLoadingSequence() {
                const loadingScreen = document.getElementById('loadingScreen');
                const terminalText = document.getElementById('terminalText');
                const loadingBar = document.getElementById('loadingBar');

                const messages = [
                    'NEXUS PROTOCOL v7.9 / CORE SUBSYSTEM: INITIALIZING',
                    'Loading neural pathways...',
                    'Establishing quantum encryption...',
                    'Connecting to HALO-Rè network...',
                    'Calibrating agent protocols...',
                    'System ready. Welcome to the Nexus.'
                ];

                let messageIndex = 0;
                let progress = 0;

                const updateLoading = () => {
                    if (messageIndex < messages.length) {
                        terminalText.innerHTML = messages[messageIndex] + '<span class="cursor">_</span>';
                        progress += 100 / messages.length;
                        loadingBar.style.width = progress + '%';
                        messageIndex++;
                        
                        setTimeout(updateLoading, 800);
                    } else {
                        setTimeout(() => {
                            loadingScreen.classList.add('hidden');
                            if (!this.isTrailerShown) {
                                this.showTrailer();
                            } else {
                                this.showMainInterface();
                            }
                        }, 500);
                    }
                };

                updateLoading();
            }

            showTrailer() {
                const trailerContainer = document.getElementById('trailerContainer');
                const trailerText = document.getElementById('trailerText');
                const trailerSubtitle = document.getElementById('trailerSubtitle');

                trailerContainer.classList.remove('hidden');

                // GSAP trailer sequence
                const tl = gsap.timeline();
                
                tl.to(trailerText, { opacity: 1, duration: 1, ease: 'power2.out' })
                  .to(trailerText, { 
                      backgroundImage: 'linear-gradient(135deg, #0AC8B9, #00FF9F)',
                      webkitBackgroundClip: 'text',
                      webkitTextFillColor: 'transparent',
                      duration: 0.5 
                  })
                  .to(trailerSubtitle, { opacity: 1, duration: 0.8, ease: 'power2.out' }, '-=0.3')
                  .to([trailerText, trailerSubtitle], { 
                      opacity: 0, 
                      duration: 1, 
                      ease: 'power2.in',
                      delay: 2
                  })
                  .call(() => {
                      trailerContainer.classList.add('hidden');
                      sessionStorage.setItem('nexus_trailer_shown', 'true');
                      this.showMainInterface();
                  });
            }

            showMainInterface() {
                const mainInterface = document.getElementById('mainInterface');
                mainInterface.classList.remove('hidden');
                
                // Entrance animation
                gsap.fromTo('.nexus-interface', 
                    { opacity: 0, scale: 0.95 },
                    { opacity: 1, scale: 1, duration: 0.8, ease: 'power2.out' }
                );

                this.logMessage('Interface loaded successfully');
                this.logMessage('Awaiting agent selection...');
            }

            resetTrailer() {
                sessionStorage.removeItem('nexus_trailer_shown');
                location.reload();
            }

            selectAgent(agentId) {
                // Remove previous selection
                document.querySelectorAll('.agent-card').forEach(card => {
                    card.classList.remove('selected');
                });

                // Add selection to clicked card
                const selectedCard = document.querySelector(`[data-agent="${agentId}"]`);
                selectedCard.classList.add('selected');

                // Update theme
                document.body.setAttribute('data-theme', agentId);

                // Enable confirm button
                const confirmButton = document.getElementById('confirmAgent');
                confirmButton.disabled = false;

                // Store selection
                this.currentAgent = agentId;

                // Update header
                const agentNames = {
                    hacker: 'Breach Architect',
                    infiltrator: 'Shadow Linguist'
                };

                document.getElementById('currentAgent').textContent = agentNames[agentId];

                // Animation
                gsap.to(selectedCard, {
                    scale: 1.05,
                    duration: 0.2,
                    ease: 'power2.out',
                    yoyo: true,
                    repeat: 1
                });

                this.logMessage(`Agent selected: ${agentNames[agentId]}`);
            }

            confirmAgentSelection() {
                if (!this.currentAgent) return;

                // Transition to mission interface
                const agentSelection = document.getElementById('agentSelection');
                const missionInterface = document.getElementById('missionInterface');

                gsap.to(agentSelection, {
                    opacity: 0,
                    x: -50,
                    duration: 0.5,
                    ease: 'power2.in',
                    onComplete: () => {
                        agentSelection.classList.add('hidden');
                        missionInterface.classList.remove('hidden');
                        
                        gsap.fromTo(missionInterface,
                            { opacity: 0, x: 50 },
                            { opacity: 1, x: 0, duration: 0.5, ease: 'power2.out' }
                        );
                    }
                });

                this.setupMissionInterface();
                this.logMessage('Agent confirmed. Preparing mission briefing...');
                document.getElementById('systemStatus').textContent = 'BRIEFING';
            }

            setupMissionInterface() {
                const abilityPanel = document.getElementById('abilityPanel');
                
                const abilities = {
                    hacker: [
                        { name: 'Ghost Port', cooldown: 18, description: 'Disable external logging' },
                        { name: 'Shard Forge', cooldown: 28, description: 'Synthesize hex-shard' },
                        { name: 'System Lattice', type: 'ultimate', description: 'Deploy backdoor network' }
                    ],
                    infiltrator: [
                        { name: 'False Face', cooldown: 20, description: 'Temporary persona overlay' },
                        { name: 'Paper Trail', cooldown: 26, description: 'Plant forged identity' },
                        { name: 'Crowd Scripting', type: 'ultimate', description: 'Manipulate public telemetry' }
                    ]
                };

                const agentAbilities = abilities[this.currentAgent];
                abilityPanel.innerHTML = '';

                agentAbilities.forEach(ability => {
                    const abilityDiv = document.createElement('div');
                    abilityDiv.className = 'nexus-card p-3';
                    abilityDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold">${ability.name}</span>
                            <span class="text-xs ${ability.type === 'ultimate' ? 'text-yellow-400' : 'text-blue-400'}">
                                ${ability.type === 'ultimate' ? 'ULTIMATE' : ability.cooldown + 's'}
                            </span>
                        </div>
                        <p class="text-sm text-gray-400">${ability.description}</p>
                    `;
                    abilityPanel.appendChild(abilityDiv);
                });
            }

            startMission() {
                this.logMessage('Mission initiated. Establishing connection...');
                document.getElementById('systemStatus').textContent = 'ACTIVE';
                
                // Start trace simulation
                this.simulateTrace();
                
                // Start objective progression
                this.progressObjectives();
            }

            simulateTrace() {
                let trace = 0;
                const traceInterval = setInterval(() => {
                    trace += Math.random() * 5;
                    if (trace > 100) trace = 100;
                    
                    this.traceLevel = trace;
                    document.getElementById('traceMeter').style.width = trace + '%';
                    document.getElementById('traceLevel').textContent = Math.round(trace) + '%';
                    
                    if (trace >= 90) {
                        this.logMessage('WARNING: High trace detected!', 'warning');
                    }
                    
                    if (trace >= 100) {
                        clearInterval(traceInterval);
                        this.logMessage('ALERT: System lockdown imminent!', 'error');
                    }
                }, 2000);
            }

            progressObjectives() {
                const objectives = ['obj1', 'obj2', 'obj3'];
                let currentObj = 0;
                
                const completeObjective = () => {
                    if (currentObj < objectives.length) {
                        const objElement = document.getElementById(objectives[currentObj]);
                        objElement.classList.add('completed');
                        
                        const messages = [
                            'Secure connection established',
                            'False identity created successfully',
                            'Security systems mapped'
                        ];
                        
                        this.logMessage(messages[currentObj], 'success');
                        currentObj++;
                        
                        if (currentObj < objectives.length) {
                            setTimeout(completeObjective, 5000 + Math.random() * 5000);
                        } else {
                            this.completePhase();
                        }
                    }
                };
                
                setTimeout(completeObjective, 3000);
            }

            completePhase() {
                const phaseDot = document.getElementById(`phase${this.currentPhase}Dot`);
                phaseDot.classList.remove('active');
                phaseDot.classList.add('completed');
                
                this.currentPhase++;
                
                if (this.currentPhase <= 3) {
                    const nextPhaseDot = document.getElementById(`phase${this.currentPhase}Dot`);
                    nextPhaseDot.classList.add('active');
                    
                    this.logMessage(`Phase ${this.currentPhase - 1} completed. Advancing to Phase ${this.currentPhase}`, 'success');
                } else {
                    this.logMessage('Mission completed successfully!', 'success');
                    document.getElementById('systemStatus').textContent = 'COMPLETE';
                }
            }

            logMessage(message, type = 'info') {
                const systemLog = document.getElementById('systemLog');
                const timestamp = new Date().toLocaleTimeString();
                
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${timestamp}]</span>
                    <span>${message}</span>
                `;
                
                systemLog.appendChild(logEntry);
                systemLog.scrollTop = systemLog.scrollHeight;
                
                // Keep only last 50 entries
                while (systemLog.children.length > 50) {
                    systemLog.removeChild(systemLog.firstChild);
                }
            }
        }

        // Global functions for HTML onclick handlers
        function selectAgent(agentId) {
            window.nexusProtocol.selectAgent(agentId);
        }

        function confirmAgentSelection() {
            window.nexusProtocol.confirmAgentSelection();
        }

        function startMission() {
            window.nexusProtocol.startMission();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.nexusProtocol = new NexusProtocol();
        });

        // Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>